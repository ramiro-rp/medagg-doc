# ADR-0004 – Поисковый модуль и интеграция medagg-search

- Статус: принято
- Дата: 2025-11-24
- Владельцы: backend-разработчик, инженер по поиску/ML
- Связанный репозиторий: `medagg-search`

## Контекст

Пользователю нужно уметь искать по каталогу датасетов, используя:

- **свободный текстовый запрос** (RU/EN), например: «pneumonia chest xray»;
- **структурированные фильтры** (модальность, область, тип задачи, теги).

Команда запланировала отдельный модуль `medagg-search`, который:

- использует **YAML-онтологию / таксономию** медицинских и технических терминов;
- парсит свободный текст и извлекает из него структурированные слоты;
- может вычислять оценки релевантности для датасетов.

Нужно определить, как этот модуль встраивается в Django-backend.

## Решение

Мы решили:

1. Оставить `medagg-search` **отдельным модулем / библиотекой**, а не частью монолита.
2. Интегрировать его с backend-ом через:
   - вызовы из view/handler-ов, отвечающих за поиск в `medagg-backend`;
   - передачу текстового запроса пользователя и опционального контекста;
   - приём нормализованной структуры запроса и подсказок по ранжированию.
3. Сохранить PostgreSQL в качестве основного хранилища и источника истины;
   поисковый модуль **не заменяет** реляционный каталог.

## Рассмотренные альтернативы

- **Полнотекстовый поиск только в PostgreSQL**  
  Плюсы:
  - не нужен отдельный модуль;
  - проще развёртывание.  
  Минусы:
  - сложнее реализовать доменно-специфическую таксономию и нормализацию RU/EN;
  - меньший контроль над интерпретацией запросов.

- **Внешний поисковый движок** (Elasticsearch, OpenSearch и т.п.)  
  Плюсы:
  - мощные возможности полнотекстового поиска;  
  Минусы:
  - дополнительная инфраструктурная сложность;
  - потенциально избыточно для учебного MVP.

## Последствия

Положительные:

- чёткое разделение между хранилищем каталога (PostgreSQL) и логикой поиска
  (`medagg-search`);
- проще экспериментировать с поведением поиска, не трогая схему БД;
- логика по работе с RU/EN и медицинскими терминами остаётся рядом с кодом поиска.

Отрицательные / риски:

- необходимость развёртывать и сопровождать дополнительный Python-модуль;
- нужно следить за согласованностью таксономии и ожиданий backend-а.

## Ссылки

- репозиторий `medagg-search`
- эндпоинты, связанные с поиском, в `medagg-backend`.
